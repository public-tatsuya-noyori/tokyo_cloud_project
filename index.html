<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Tokyo cloud project</title>
</head>
<body>
<h1 style="text-align:center">Tokyo cloud project</h1><h2>1. Publish/Subscribe/Clone on cloud (not using MQPs)</h2><h3>&nbsp; 1.1&nbsp;Evaluation</h3><div style="padding-left:40px">Publish/Subscribe/Clone on cloud (not using MQPs) has been being&nbsp;evaluated by using&nbsp;the following resources.</div><div><ul style="padding-left:80px"><li><a href="https://www.wis-jma.go.jp/data/subscribe">wis-jma</a> to download all GTS&nbsp;data on Tokyo.</li><li><a href="https://www.amazon.com/HP-EliteDesk-800-G5-Computer/dp/B085DNKWST">HP EliteDesk 800 G5 SFF</a> as a&nbsp;local PC.</li><li>3&nbsp;<a href="https://wasabi.com/connectivity-options/">wasabi cloud regions</a>&nbsp;as follows:<a href="https://wasabi.com/connectivity-options/"></a></li></ul><ul style="padding-left:120px"><li>ap-northeast-1 region of Wasabi&nbsp;cloud to publish <a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data/">open data</a>&nbsp; and <a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.closed.data/">closed data</a>.</li><li>us-east-1 region of Wasabi cloud to clone <a href="https://s3.wasabisys.com/japan.meteorological.agency.open.data.us.east.1/">open data</a><a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data.aws.js.s3.explorer/us-east-1.html"></a> and <a href="https://s3.wasabisys.com/japan.meteorological.agency.closed.data.us.east.1/">closed data</a>.</li><li>eu-central-1 region of Wasabi cloud to subscribe <a href="https://s3.eu-central-1.wasabisys.com/japan.meteorological.agency.open.data.eu.central.1">open data</a> and <a href="https://s3.eu-central-1.wasabisys.com/japan.meteorological.agency.closed.data.eu.central.1">closed data</a>.</li></ul><div style="padding-left:40px"><br></div><div style="padding-left:40px">The diagram of the&nbsp;data flow to evaluate&nbsp;Publish/Subscribe/Clone on cloud is as follows:</div></div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;<img src="data_flow_diagram.png"><br></div><div style="padding-left:40px"><br></div><div style="padding-left:40px">The data files  published/cloned in&nbsp;each region&nbsp;can be&nbsp;explorered&nbsp;by using the&nbsp;following aws-js-s3-explorers.</div><div style="padding-left:80px"><ul><li><a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data.aws.js.s3.explorer/ap-northeast-1.html">ap-northeast-1 explorer</a></li><li><a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data.aws.js.s3.explorer/us-east-1.html">us-east-1 explorer</a></li><li><a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data.aws.js.s3.explorer/eu-central-1.html">eu-central-1 explorer</a></li></ul></div><div><div style="padding-left:40px"><br></div><div style="padding-left:40px">The data files are&nbsp;classified by the following priority and classification.</div><div style="padding-left:80px"><table style="border:1px solid #000000"><tbody><tr><td style="background-color:#cccccc;border:1px solid #000000;text-align:center">priority</td><td style="background-color:#cccccc;border:1px solid #000000;text-align:center">classification</td></tr><tr><td style="border:1px solid #000000;text-align:center">p1</td><td style="border:1px solid #000000">warning</td></tr><tr><td style="border:1px solid #000000;text-align:center">p2</td><td style="border:1px solid #000000">Alphanumeric/CREX/IWXXM</td></tr><tr><td style="border:1px solid #000000;text-align:center">p3</td><td style="border:1px solid #000000">BUFR(not satellite)</td></tr><tr><td style="border:1px solid #000000;text-align:center">p4</td><td style="border:1px solid #000000">satellite(BUFR/HDF5)</td></tr><tr><td style="border:1px solid #000000;text-align:center">p5</td><td style="border:1px solid #000000">GRIB</td></tr></tbody></table></div><div style="padding-left:40px"><div><div><br></div><div>The prioritized and classified data files are indexed in the "4PubSub" directory. The directory of '4PubSub' is as follows by using&nbsp;the above&nbsp;aws-js-s3-explorer.</div></div>  </div><div style="padding-left:80px"><img src="4pubsub.png"><ul></ul></div></div><div style="padding-left:40px"><br></div><div style="padding-left:40px">There are priority directories of "p1", "p2", "p3", "p4" and&nbsp;"p5" in the directory of "4PubSub" as follows.&nbsp;</div><div style="padding-left:80px"><img src="4pubsub_priority.png"></div><div style="padding-left:40px"><br></div><div style="padding-left:40px">There are index files with the file name of the created datetime in each&nbsp;priority directories as follows.</div><div style="padding-left:80px"><img src="4pubsub_priority_p1.png"></div><div style="padding-left:40px"><br></div><div style="padding-left:40px">The index file is&nbsp;a&nbsp;list of links to the created data files as follows.</div><div style="padding-left:80px"><img src="4pubsub_priority_p1_index_file.png">&nbsp;<br></div><div style="padding-left:40px"><br></div><div style="padding-left:40px">In this evaluation, all GTS&nbsp;data files&nbsp;are&nbsp;published/subscribed/cloned&nbsp;using the '4PubSub' directory without MQPs.</div><div style="padding-left:40px">  The average/maximum transfer time of&nbsp;the prioritized and classified data files are as follows.</div><div style="padding-left:80px"><table style="border-style:solid;border-color:#000000"><tbody><tr><td style="background-color:#cccccc;border-style:solid;border-color:#000000;text-align:center">priority</td><td style="background-color:#cccccc;border-style:solid;border-color:#000000;text-align:center">&nbsp;average transfer time(2020/10/21)<div>(local PC -&gt; ap-northeast -&gt; us-east -&gt; eu-central)</div></td><td style="background-color:#cccccc;border-style:solid;border-color:#000000;text-align:center"><div>maximum transfer time(2020/10/21)  </div><div>(local PC -&gt; ap-northeast -&gt; us-east -&gt; eu-central)</div></td><td style="background-color:#cccccc;border-style:solid;border-color:#000000;text-align:center">The number of open data files(2020/10/22)</td><td style="background-color:#cccccc;border-style:solid;border-color:#000000;text-align:center">The number of parallel transfers</td></tr><tr><td style="border-style:solid;border-color:#000000;text-align:center">p1</td><td style="border-style:solid;border-color:#000000;text-align:center">35s</td><td style="border-style:solid;border-color:#000000;text-align:center">68s</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;405</td><td style="border-style:solid;border-color:#000000;text-align:center">4</td></tr><tr><td style="border-style:solid;border-color:#000000;text-align:center">p2</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;3m5s</td><td style="border-style:solid;border-color:#000000;text-align:center">3m47s</td><td style="border-style:solid;border-color:#000000;text-align:center">31655</td><td style="border-style:solid;border-color:#000000;text-align:center">8</td></tr><tr><td style="border-style:solid;border-color:#000000;text-align:center">p3</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;3m5s</td><td style="border-style:solid;border-color:#000000;text-align:center">4m0s</td><td style="border-style:solid;border-color:#000000;text-align:center">35074</td><td style="border-style:solid;border-color:#000000;text-align:center">16</td></tr><tr><td style="border-style:solid;border-color:#000000;text-align:center">p4</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;3m19s</td><td style="border-style:solid;border-color:#000000;text-align:center">18m7s</td><td style="border-style:solid;border-color:#000000;text-align:center">155355</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;64</td></tr><tr><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;p5</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;15m30s</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;29m1s</td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;47763  </td><td style="border-style:solid;border-color:#000000;text-align:center">&nbsp;32</td></tr></tbody></table></div><div style="padding-left:40px"><br></div><h3>&nbsp;&nbsp;1.2 How to publish/subscribe/clone on cloud</h3><h4 style="padding-left:40px">1.2.1&nbsp;Install rclone</h4><a href="https://rclone.org/install/"><p style="padding-left:80px">Reference</p></a><div style="padding-left:120px"><pre><code>curl https://rclone.org/install.sh | sudo bash</code></pre></div><h4 style="padding-left:40px">1.2.2&nbsp;Configure rclone</h4><div><div style="padding-left:120px"><pre><code>vi $HOME/.config/rclone/rclone.conf<br>
[wasabi]
type = s3
env_auth = false
access_key_id =
secret_access_key =
region =
endpoint = https://s3.ap-northeast-1.wasabisys.com
location_constraint =
acl = public-read
server_side_encryption =
storage_class =
[wasabi_us]
type = s3
env_auth = false
access_key_id =
secret_access_key =
region =
endpoint = https://s3.us-east-1.wasabisys.com
location_constraint =
acl = public-read
server_side_encryption =
storage_class =
[wasabi_eu]
type = s3
env_auth = false
access_key_id =
secret_access_key =
region =
endpoint = https://s3.eu-central-1.wasabisys.com
location_constraint =
acl = public-read
server_side_encryption =
storage_class =<br>
:wq</code></pre></div></div><h4 style="padding-left:40px">1.2.3&nbsp;Install pub.sh/sub.sh/clone.sh</h4><div style="padding-left:80px">Download <a href="https://raw.githubusercontent.com/public-tatsuya-noyori/meteorological_preprocessor/master/src/meteorological_preprocessor/pub.sh">pub.sh</a>/<a href="https://raw.githubusercontent.com/public-tatsuya-noyori/meteorological_preprocessor/master/src/meteorological_preprocessor/sub.sh">sub.sh</a>/<a href="https://raw.githubusercontent.com/public-tatsuya-noyori/meteorological_preprocessor/master/src/meteorological_preprocessor/clone.sh">clone.sh</a></div><h4 style="padding-left:40px">1.2.4&nbsp;Configure Cron</h4><div style="padding-left:80px">The configuration of the Cron to subscribe p3 data files are as follows:  <br></div><div style="padding-left:120px"><div><pre>crontab -e
<br>
* * * * * /path_to_sh/sub.sh --cron cache wasabi_open_data_p3 wasabi japan.meteorological.agency.open.data p3 16
<br>
:wq
</pre></div>  <br></div><h3> &nbsp; 1.3&nbsp;Cost</h3><div>&nbsp; &nbsp; &nbsp;<a href="https://wasabi.com/cloud-storage-pricing/" style="font-size:x-large">only&nbsp;$5.99 per&nbsp;month</a>  <span style="font-size:x-large"><br></span></div><h2>2.&nbsp;Monitor on cloud  and Dataset API</h2><h3>&nbsp; 2.1 Monitor on cloud</h3><div style="padding-left:40px">Monitor on cloud&nbsp;is <a href="https://s3.ap-northeast-1.wasabisys.com/japan.meteorological.agency.open.data.aws.js.s3.explorer/org/meteorological_visualizer.html">here</a>.&nbsp;</div><div style="padding-left:40px"><img src="monitor.png"><br></div><div style="padding-left:40px"><br></div><h3>&nbsp; 2.2&nbsp;Dataset API</h3><div style="padding-left:40px">Dataset API is <a href="https://arrow.apache.org/docs/python/dataset.html">here</a>. Dataset API is being&nbsp;evaludated.</div><h3>&nbsp; 2.3&nbsp;Cost</h3><div style="font-size:x-large">&nbsp; &nbsp; <a href="https://wasabi.com/cloud-storage-pricing/" target="_blank">only&nbsp;$5.99 per&nbsp;month</a>  </div><h2>3.&nbsp;manual on cloud</h2><h4>&nbsp; 3.1&nbsp;Publish/Subscribe/Clone (not using MQPs)<br></h4><div style="padding-left:40px">3.1 publish to cloud</div><div style="padding-left:80px">A reference implementation is <a href="https://github.com/public-tatsuya-noyori/meteorological_preprocessor/blob/master/src/meteorological_preprocessor/pub.sh">pub.sh</a>.</div><div style="padding-left:80px">The&nbsp;protocol to publish is as follows.&nbsp;</div><div style="padding-left:120px"><ol><li>upload data&nbsp;files.</li><li>upload a file of a list of the uploaded data&nbsp;files to the directory of "4PubSub/p[1-9]". The name of the file is YYYYMMDDHHMMSS.txt.</li></ol></div><div><div style="padding-left:40px">3.2&nbsp;subscribe from&nbsp;cloud</div><div style="padding-left:80px">A reference implementation is <a href="https://github.com/public-tatsuya-noyori/meteorological_preprocessor/blob/master/src/meteorological_preprocessor/sub.sh">sub.sh</a>.</div><div style="padding-left:80px">The protocol to subscribe&nbsp;is as follows.</div><div style="padding-left:120px"><ol><li>download a current&nbsp;list of the&nbsp;index&nbsp;files in&nbsp;"4PubSub/p[1-9]"</li><li>get the newly created list of the&nbsp;index&nbsp;files&nbsp;by comparing the previous list with the current list.</li><li>download newly created index&nbsp;files&nbsp;from the directory of "4PubSub/p[1-9]  ".</li><li>download data files that are&nbsp;linked in each index files.&nbsp;</li></ol></div><div style="padding-left:40px">3.3 clone cloud to cloud</div><div style="padding-left:80px">A reference implementation is <a href="https://github.com/public-tatsuya-noyori/meteorological_preprocessor/blob/master/src/meteorological_preprocessor/clone.sh">clone.sh</a>.</div><div style="padding-left:80px">The protocol to clone&nbsp;is as follows.&nbsp;</div><div style="padding-left:120px"><ol><li>download a current&nbsp;list of the&nbsp;index&nbsp;files in&nbsp;"4PubSub/p[1-9]"</li><li>get the newly created list of the&nbsp;index&nbsp;files&nbsp;by comparing the previous list with the current list.</li><li>download newly created index&nbsp;files&nbsp;from the directory of "4PubSub/p[1-9] ".</li><li>copy data files that are&nbsp;linked&nbsp;in each index files from source cloud to destination cloud.&nbsp;</li><li>upload a file of a list of the copied&nbsp;data files to the directory of "4PubSub/p[1-9]". The name of the file is YYYYMMDDHHMMSS.txt.&nbsp;</li></ol></div></div><div style="padding-left:40px">3.4 directory name convention</div><div style="padding-left:80px">To publish&nbsp;data files on cloud, directory name convention is needed.</div><div style="padding-left:80px">The directory name convention is as follows.</div><div style="padding-left:120px"><ol><li>[bucket]/[indicator]/[format]/[category]/[subcategory]/[year+month+day+hour+minute]/</li><li>Directory names&nbsp;above&nbsp;are all&nbsp;lowercase.</li><li>[bucket] is bucket of&nbsp;cloud storage.</li><li>[indicator] is location indicator.</li><li>[format] is 'alphanumeric' or 'bufr' or 'crex' or 'grib' or&nbsp;.</li><li>q</li><li></li><li></li><li>not finished yet</li></ol><div><br></div></div><div style="padding-left:0px"><br style="padding-left:80px"></div>  
</body>
</html>
